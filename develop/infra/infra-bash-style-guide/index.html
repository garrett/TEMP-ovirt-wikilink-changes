<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
Infra Bash style guide &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href="/stylesheets/application.css" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'>
<h1>
<a href="/"><img id="logo" class="logo is-svg" alt="oVirt" src="/images/logo.svg" />
</a></h1>
</section>
<div id='access'>
<nav role='navigation'>
<ul class='nav nav-pills'>
<li class='nav-link-home' role='menuitem'>
<a href='/'>Home</a>
</li>

<li class='nav-link-blog' role='menuitem'>
<a href='/blog/'>Blog</a>
</li>

<li class='nav-link-download' role='menuitem'>
<a href='/download/'>Download</a>
</li>

<li class='nav-link-documentation' role='menuitem'>
<a href='/documentation/'>Documentation</a>
</li>

<li class='nav-link-develop' role='menuitem'>
<a href='/develop/'>Develop</a>
</li>

<li class='nav-link-community' role='menuitem'>
<a href='/community/'>Community</a>
</li>

<li class='nav-link-search' role='menuitem'>
<a href='/search/'>Search</a>
</li>

</ul>
</nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<ul class='breadcrumb'>
<li><a href="/develop/">Develop</a></li>
<li><a href="/develop/infra/">Infra</a></li>
<li class='active'>Infra Bash style guide</li>
</ul>

<section class='container content' id='content'>
<div class='alert alert-warning'>
<div class='pull-right'>
<a>Hover for more info</a>
</div>
<div class='frontmatter-metadata'>
<table class='metadata'>
<caption>Frontmatter Metadata</caption>
<tr>
<th>title</th>
<td>Infra Bash style guide</td>
</tr>
<tr>
<th>category</th>
<td>infra</td>
</tr>
<tr>
<th>authors</th>
<td>dcaroest</td>
</tr>
<tr>
<th>wiki_category</th>
<td>Infrastructure</td>
</tr>
<tr>
<th>wiki_title</th>
<td>Infra Bash style guide</td>
</tr>
<tr>
<th>wiki_revision_count</th>
<td>22</td>
</tr>
<tr>
<th>wiki_last_updated</th>
<td>2015-07-16</td>
</tr>
</table>
</div>
Original Wiki page:
<a href='http://old.ovirt.org/Infra_Bash_style_guide' target='_blank'>
Infra Bash style guide
</a>
</div>

<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<p><strong>NOTE</strong>: for the latest version of this doc, see <a href="http://ovirt-infra-docs.readthedocs.org/en/latest/">http://ovirt-infra-docs.readthedocs.org/en/latest/</a></p>

<h1 id="infra-bash-scripts-style-guide">Infra bash scripts style guide</h1>

<p>These are some coding guidelines in order to have a reference when submitting patches. It's based on <a href="http://wiki.bash-hackers.org/scripting/style">the Bash Hackers guidelines</a>.</p>

<p>This is not an enforcement, it's meant to be just a reference, of course, compliance is preferred.</p>

<p>Some good code layout helps you to read your own code after a while. And of course it helps others to read the code too.</p>

<h1 id="basic-principles">Basic principles</h1>

<ul>
  <li>First robustness</li>
  <li>Second readablity/maintainability</li>
  <li>Third portability</li>
</ul>

<p>That is why we allow and encourage bashisms, if that improves the robustness or the readablity of the script.</p>

<h1 id="indenting-and-line-breaks">Indenting and line breaks</h1>

<h3 id="use-4-spaces-per-indent">Use 4 spaces per indent</h3>

<p>To indent, use 4 spaces per indentation level, similar to python indentation.</p>

<p>Whenever possible use the 79 chars max line.</p>

<p>Avoid hard-tabs when possible. I can imagine only one case where they're useful: Indenting here-documents.</p>

<pre class="highlight shell"><code><span class="c"># No:</span>&#x000A;my_func<span class="o">()</span> <span class="o">{</span>&#x000A;tab&gt;echo <span class="s1">'bla'</span>&#x000A;<span class="o">}</span>&#x000A;my_func2<span class="o">()</span> <span class="o">{</span>&#x000A;  <span class="nb">echo</span> <span class="s1">'bla'</span>&#x000A;<span class="o">}</span>&#x000A;</code></pre>

<pre class="highlight shell"><code><span class="c"># Yes:</span>&#x000A;my_func<span class="o">()</span> <span class="o">{</span>&#x000A;    <span class="nb">echo</span> <span class="s1">'bla'</span>&#x000A;<span class="o">}</span>&#x000A;</code></pre>

<h3 id="if-you-have-to-split-a-command-use-one-option-per-line-with-extra-indent">If you have to split a command, use one option per line, with extra indent</h3>

<pre class="highlight shell"><code>my_command <span class="se">\</span>&#x000A;    --opt1 opt1_arg1 <span class="se">\</span>&#x000A;    --opt2 <span class="se">\</span>&#x000A;    arg1 <span class="se">\</span>&#x000A;    arg2&#x000A;</code></pre>

<h3 id="break-sequences-pre-operator-same-indent">Break sequences pre-operator, same indent</h3>

<pre class="highlight shell"><code>command1 <span class="se">\</span>&#x000A;<span class="o">||</span> command2 <span class="se">\</span>&#x000A;<span class="o">&amp;&amp;</span> command3 <span class="se">\</span>&#x000A;| command4&#x000A;</code></pre>

<h3 id="break-before-redirection-same-indent">Break before redirection, same indent</h3>

<pre class="highlight shell"><code><span class="nb">command</span> <span class="se">\</span>&#x000A;<span class="gp">1&gt; </span>outfile <span class="se">\</span>&#x000A;<span class="gp">2&gt; </span>errorlog&#x000A;</code></pre>

<h3 id="compound-commands-basic-layout">Compound commands: basic layout</h3>

<pre class="highlight shell"><code>HEAD_KEYWORD parameters; BODY_BEGIN&#x000A;    BODY_COMMANDS&#x000A;BODY_END&#x000A;</code></pre>

<h4 id="long-predicates">Long predicates</h4>

<p>Avoid long predicates as much as possible, but if you have to:</p>

<pre class="highlight shell"><code>HEAD_KEYWORD command1 <span class="se">\</span>&#x000A;OPERATOR command2 <span class="se">\</span>&#x000A;OPERATOR commandN <span class="se">\</span>&#x000A;BODY_BEGIN&#x000A;    BODY_COMMANDS&#x000A;BODY_END&#x000A;</code></pre>

<p>Or if you have one command with long options:</p>

<pre class="highlight shell"><code>HEAD_KEYWORD command1 <span class="se">\</span>&#x000A;    --myoption <span class="se">\</span>&#x000A;    param1 <span class="se">\</span>&#x000A;    param2 <span class="se">\</span>&#x000A;BODY_BEGIN&#x000A;    BODY_COMMANDS&#x000A;BODY_END&#x000A;</code></pre>

<p>But try to use a function or storing the return code if able:</p>

<pre class="highlight shell"><code>test_something<span class="o">()</span> <span class="o">{</span>&#x000A;    command1 <span class="se">\</span>&#x000A;    OPERATOR command2 <span class="se">\</span>&#x000A;    OPERATOR command3&#x000A;    <span class="k">return</span> <span class="nv">$?</span>&#x000A;<span class="o">}</span>&#x000A;&#x000A;HEAD_KEYWORD test_something; BODY_BEGIN&#x000A;    BODY_COMMANDS&#x000A;BODY_END&#x000A;&#x000A;command1 <span class="se">\</span>&#x000A;    --myoption <span class="se">\</span>&#x000A;    param1 <span class="se">\</span>&#x000A;    param2&#x000A;<span class="nv">command1_res</span><span class="o">=</span><span class="nv">$?</span>&#x000A;&#x000A;HEAD_KEYWORD [[ <span class="s2">"</span><span class="nv">$command1_res</span><span class="s2">"</span> <span class="o">==</span> 0 <span class="o">]]</span>; BODY_BEGIN&#x000A;    BODY_COMMANDS&#x000A;BODY_END&#x000A;</code></pre>

<h4 id="ifthenelifelse">if/then/elif/else</h4>

<pre class="highlight shell"><code><span class="k">if</span> ...; then&#x000A;    ...&#x000A;<span class="k">elif</span> ...; then&#x000A;    ...&#x000A;<span class="k">else</span>&#x000A;    ...&#x000A;<span class="k">fi</span>&#x000A;</code></pre>

<h4 id="for">for</h4>

<pre class="highlight shell"><code><span class="k">for</span> f in /etc/<span class="k">*</span>; do&#x000A;    ...&#x000A;<span class="k">done</span>&#x000A;</code></pre>

<h4 id="whileuntil">while/until</h4>

<pre class="highlight shell"><code><span class="k">while</span> [[ <span class="s2">"</span><span class="nv">$answer</span><span class="s2">"</span> !<span class="o">=</span> [YyNn] ]]; do&#x000A;    ...&#x000A;<span class="k">done</span>&#x000A;</code></pre>

<h4 id="case">case</h4>

<pre class="highlight shell"><code><span class="k">case</span> <span class="nv">$input</span> in&#x000A;    hello<span class="p">)</span> echo <span class="s2">"You said hello"</span><span class="p">;;</span>&#x000A;    bye<span class="p">)</span>&#x000A;        echo <span class="s2">"You said bye"</span>&#x000A;        if foo; then&#x000A;            bar&#x000A;        fi&#x000A;    ;;&#x000A;    <span class="k">*</span><span class="o">)</span>&#x000A;        echo <span class="s2">"You said something weird..."</span>&#x000A;    ;;&#x000A;<span class="k">esac</span>&#x000A;</code></pre>

<h1 id="syntax-and-coding-guidelines">Syntax and coding guidelines</h1>

<h3 id="basic-structure">Basic structure</h3>

<p>The basic structure of a script simply reads:</p>

<pre class="highlight shell"><code><span class="c">#!SHEBANG</span>&#x000A;GLOBAL_CONFIGURATION_CONSTANTS&#x000A;FUNCTION_DEFINITIONS&#x000A;<span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span> <span class="o">=</span>~ /bash<span class="nv">$ </span><span class="o">]]</span>; <span class="k">then</span>&#x000A;  PARSING_OPTIONS&#x000A;  VERIFYING_OPTIONS&#x000A;  SIMPLE_MAIN_CODE&#x000A;<span class="k">fi</span>&#x000A;</code></pre>

<h3 id="shebang-use-binbash--e">Shebang: use <code>/bin/bash -e</code></h3>

<p>If possible (I know it's not always possible!), use a shebang. Be careful with <em>/bin/sh</em>: The argument that "on Linux <em>/bin/sh</em> is a Bash" <strong>is a lie</strong> (and technically irrelevant) The shebang serves two purposes for me:</p>

<ul>
  <li>it specifies the interpreter when the script file is called directly: If you code for Bash, specify <em>bash</em>!</li>
  <li>it documents the desired interpreter (so: use <em>bash</em> when you write a Bash-script, use <em>sh</em> when you write a general Bourne/POSIX script, …)</li>
</ul>

<p>Whenever able, use the <em>-e</em> flag, that will make sure your script fails if any of the commands fail:</p>

<pre class="highlight shell"><code><span class="c">#!/bin/bash -e</span>&#x000A;</code></pre>

<p>If you don't really care about one of the commands failing (or returning <code>!= 0</code>) you can use this:</p>

<pre class="highlight shell"><code>mycommand || :&#x000A;</code></pre>

<h3 id="use---and-not--">Use <code>[[ ]]</code> and not <code>[ ]</code></h3>

<p>Prefer the bash keyword <code>[[ ]]</code> to the old <code>test</code> command, it's behavior is a lot more predictable, as it handles spaces as expected.</p>

<pre class="highlight shell"><code><span class="c"># No</span>&#x000A;<span class="k">if</span> <span class="o">[</span> -e <span class="s2">"</span><span class="nv">$my_var</span><span class="s2">"</span> <span class="o">]</span>; <span class="k">then</span>&#x000A;    ...&#x000A;<span class="k">fi</span>&#x000A;</code></pre>

<pre class="highlight shell"><code><span class="c"># Yes</span>&#x000A;<span class="k">if</span> <span class="o">[[</span> -e <span class="s2">"</span><span class="nv">$my_var</span><span class="s2">"</span> <span class="o">]]</span>; <span class="k">then</span>&#x000A;    ...&#x000A;<span class="k">fi</span>&#x000A;</code></pre>

<h3 id="declare-all-globals-at-the-start-of-the-script">Declare all globals at the start of the script</h3>

<p>Even if empty or inheriting from the env, declare all the globals for better visibility at the top of the script.</p>

<pre class="highlight shell"><code><span class="c">#/usr/bin/env bash -e</span>&#x000A;&#x000A;<span class="nv">MY_VAR1</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">ENV_VAR</span><span class="k">:-</span><span class="nv">default</span><span class="p"> value1</span><span class="k">}</span><span class="s2">"</span>&#x000A;<span class="nv">MY_VAR2</span><span class="o">=</span><span class="s1">'default value2'</span>&#x000A;</code></pre>

<h3 id="use-dottedprefixed-names-in-libraries">Use dotted/prefixed names in libraries</h3>

<p>That way it's a lot easier to debug and maintain all the scripts.</p>

<pre class="highlight shell"><code><span class="c">#### mylib.sh ####</span>&#x000A;<span class="c">#/usr/bin/env bash -e</span>&#x000A;&#x000A;<span class="nv">mylib_MYVAR1</span><span class="o">=</span><span class="s2">""</span>&#x000A;&#x000A;mylib.func1<span class="o">()</span> <span class="o">{</span>&#x000A;    ...&#x000A;<span class="o">}</span>&#x000A;</code></pre>

<h3 id="use-caps-and-underscores-for-globals">Use caps and underscores for globals</h3>

<p>Also if it could collide with a <a href="http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap08.html#tag_08">reserved var</a>, add a prefix like <code>MY_</code>:</p>

<pre class="highlight shell"><code><span class="nv">MY_GLOBAL</span><span class="o">=</span><span class="s2">"whatever"</span>&#x000A;</code></pre>

<h3 id="use-at-least-3-chars-for-any-variable">Use at least 3 chars for any variable</h3>

<pre class="highlight shell"><code><span class="c"># No</span>&#x000A;<span class="nv">m</span><span class="o">=</span><span class="s2">"whatever"</span>&#x000A;</code></pre>

<pre class="highlight shell"><code><span class="c"># Yes</span>&#x000A;<span class="nv">msg</span><span class="o">=</span><span class="s2">"whatever"</span>&#x000A;</code></pre>

<h3 id="prefer-keywords-to-builtins">Prefer keywords to Builtins</h3>

<pre class="highlight shell"><code><span class="c"># No</span>&#x000A;<span class="nv">my_var</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$my_var</span><span class="s2">"</span> | cut -d<span class="s1">' '</span> -f1<span class="k">)</span><span class="s2">"</span>&#x000A;</code></pre>

<pre class="highlight shell"><code><span class="c"># Yes</span>&#x000A;<span class="gp">my_var="${my_var%% </span><span class="k">*</span><span class="o">}</span><span class="s2">"&#x000A;</span></code></pre>

<h3 id="if-not-101-sure-quote-all-variable-expansions">If not 101% sure, quote all variable expansions</h3>

<p>If not, they will undergo path expansion.</p>

<pre class="highlight shell"><code><span class="nv">var1</span><span class="o">=</span><span class="s2">"</span><span class="nv">$var2</span><span class="s2">"</span>&#x000A;<span class="k">for </span>iter <span class="k">in</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>; <span class="k">do</span>&#x000A;    ...&#x000A;<span class="k">done</span>&#x000A;</code></pre>

<h3 id="arrays-are-there-use-them">Arrays are there, use them!</h3>

<pre class="highlight shell"><code><span class="nv">var1</span><span class="o">=(</span>&#x000A;    <span class="s2">"elem one"</span>&#x000A;    <span class="s2">"elem two"</span>&#x000A;<span class="o">)</span>&#x000A;var1+<span class="o">=(</span> <span class="s2">"elem three"</span> <span class="o">)</span>&#x000A;<span class="k">for </span>iter <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">var1</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span>; <span class="k">do</span>&#x000A;    ....&#x000A;<span class="k">done</span>&#x000A;</code></pre>

<h3 id="when-expanding-arrays-use-">When expanding arrays, use <code>"$@"</code></h3>

<p>It expads spaces properly. and unless you really know what you are doing, that's what you expect.</p>

<pre class="highlight shell"><code><span class="c"># No</span>&#x000A;<span class="k">for </span>iter <span class="k">in</span> <span class="k">${</span><span class="nv">my_array</span><span class="p">[*]</span><span class="k">}</span>; <span class="k">do</span>&#x000A;    ...&#x000A;<span class="k">done</span>&#x000A;</code></pre>

<pre class="highlight shell"><code><span class="c"># Yes</span>&#x000A;<span class="k">for </span>iter <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">my_array</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span>; <span class="k">do</span>&#x000A;    ...&#x000A;<span class="k">done</span>&#x000A;</code></pre>

<h3 id="dont-use--use-">Don't use `, use <code>$()</code></h3>

<p>Though being more portable, the backtick is less robust, it's not nestable and it's less readable.</p>

<pre class="highlight shell"><code><span class="c"># No</span>&#x000A;<span class="nv">my_var</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="sb">`</span>ls<span class="sb">``</span>&#x000A;</code></pre>

<pre class="highlight shell"><code><span class="c">#Yes</span>&#x000A;<span class="nv">my_var</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">$(</span>ls<span class="k">)</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span>&#x000A;</code></pre>

<h3 id="quote-all-command-expansions-">Quote all command expansions <code>"$()"</code></h3>

<p>Mainly because the result of the command expansion will undergo word splitting and path expansion, and that's usually not wanted. In some cases, like defining a var it will not, but as that's not generic, the safest is to quote it always.</p>

<pre class="highlight shell"><code><span class="c"># No</span>&#x000A;<span class="c"># Will work, but just in this case</span>&#x000A;<span class="nv">my_asterisc</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s1">'*'</span><span class="k">)</span>&#x000A;<span class="c"># Now it will be expanded to all the current dir contents</span>&#x000A;ls <span class="k">$(</span><span class="nb">echo</span> <span class="s1">'*'</span><span class="k">)</span>&#x000A;</code></pre>

<pre class="highlight shell"><code><span class="c"># Yes</span>&#x000A;<span class="c"># result is the same as without quotes</span>&#x000A;<span class="nv">my_asterisc</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nb">echo</span> <span class="s1">'*'</span><span class="k">)</span><span class="s2">"</span>&#x000A;<span class="c"># but now it will only show a file/dir named '*'</span>&#x000A;ls <span class="s2">"</span><span class="k">$(</span><span class="nb">echo</span> <span class="s1">'*'</span><span class="k">)</span><span class="s2">"</span>&#x000A;</code></pre>

<h3 id="if-eval-is-the-answer-surely-you-are-asking-the-wrong-question">If eval is the answer, surely you are asking the wrong question</h3>

<p>Avoid if, unless absolutely neccesary, it's usually unnecessary, and it's really easy to break things. Use only if you really have to and you know what you are doing (add a comment too, so future you will remember).</p>

<h3 id="output-normal--stdout-error--debug--stderr">Output: <code>normal &gt; stdout</code>, <code>error + debug &gt; stderr</code></h3>

<p>If the script gives syntax help (<code>-?</code> or <code>-h</code> or <code>--help</code> arguments), it should go to <em>STDOUT</em>, since it's expected output, unless it's a response to a missing or malformed parameter.</p>

<h3 id="prefer-gnu-getopt-to-getopts">Prefer gnu <code>getopt</code> to <code>getopts</code></h3>

<p>It's more robust, implements the more readable gnu long options, plus POSIX, and does not hurt readability too much</p>

<pre class="highlight shell"><code><span class="c"># No</span>&#x000A;<span class="k">while </span><span class="nb">getopts </span>a:b:c flag; <span class="k">do&#x000A;    case</span> <span class="nv">$flag</span> <span class="k">in&#x000A;        </span>a<span class="p">)</span>&#x000A;            <span class="nb">echo</span> <span class="s2">"-a used: </span><span class="nv">$OPTARG</span><span class="s2">"</span>;&#x000A;        <span class="p">;;</span>&#x000A;        ...&#x000A;        ?<span class="p">)</span>&#x000A;            <span class="nb">exit</span>;&#x000A;        <span class="p">;;</span>&#x000A;    <span class="k">esac</span>&#x000A;<span class="k">done&#x000A;</span><span class="nb">shift</span> <span class="k">$((</span> OPTIND <span class="o">-</span> <span class="m">1</span> <span class="k">))</span>;&#x000A;</code></pre>

<pre class="highlight shell"><code><span class="c"># Yes</span>&#x000A;<span class="nb">local </span><span class="nv">args</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>getopt -o a:b:c -l <span class="s2">"ay:,bee:,cee"</span> -n <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span> -- <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span>&#x000A;<span class="c">#Bad arguments</span>&#x000A;<span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> -ne 0 <span class="o">]]</span>; <span class="k">then&#x000A;    </span><span class="nb">exit </span>1&#x000A;<span class="k">fi&#x000A;</span><span class="nb">eval set</span> -- <span class="s2">"</span><span class="nv">$args</span><span class="s2">"</span>;&#x000A;<span class="k">while </span><span class="nb">true</span>; <span class="k">do&#x000A;    case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in</span>&#x000A;        -a|--ay<span class="p">)</span>&#x000A;            <span class="nb">shift</span>;&#x000A;            <span class="k">if</span> <span class="o">[[</span> -n <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]]</span>; <span class="k">then&#x000A;                </span><span class="nb">echo</span> <span class="s2">"-a used: </span><span class="nv">$1</span><span class="s2">"</span>;&#x000A;                <span class="nb">shift</span>;&#x000A;            <span class="k">fi</span>&#x000A;        <span class="p">;;</span>&#x000A;        ...&#x000A;        --<span class="p">)</span>&#x000A;            <span class="c"># end of options</span>&#x000A;            <span class="nb">shift</span>;&#x000A;            <span class="nb">break</span>;&#x000A;        <span class="p">;;</span>&#x000A;    <span class="k">esac</span>&#x000A;<span class="k">done</span>&#x000A;</code></pre>

<h3 id="always-check-the-input">Always check the input</h3>

<p>Never blindly assume anything. If you want the user to input a number, <strong>check the input</strong> for being a number, check for leading zeros, etc… Users will do what they want, not what the program wants. If you have specific format or content needs, <strong>always check the input</strong></p>

<h3 id="functions">Functions</h3>

<h4 id="define-local-variables-with-local-and-one-per-line">Define local variables with <code>local</code> and one per line</h4>

<pre class="highlight shell"><code><span class="nb">local </span>var1 <span class="se">\</span>&#x000A;      var2 <span class="se">\</span>&#x000A;      var3&#x000A;</code></pre>

<p>Or</p>

<pre class="highlight shell"><code><span class="nb">local </span>var1&#x000A;<span class="nb">local </span>var2&#x000A;<span class="nb">local </span>var3&#x000A;</code></pre>

<h4 id="define-the-parameter-holder-vars-first">Define the parameter holder vars first</h4>

<pre class="highlight shell"><code>my_func<span class="o">()</span> <span class="o">{</span>&#x000A;    <span class="nb">local </span><span class="nv">my_param1</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span>:?<span class="k">}</span><span class="s2">"</span>&#x000A;    <span class="nb">local </span><span class="nv">my_param2</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">2</span>:?<span class="k">}</span><span class="s2">"</span>&#x000A;    <span class="nb">local </span>other1 <span class="se">\</span>&#x000A;          other2&#x000A;    ...&#x000A;<span class="o">}</span>&#x000A;</code></pre>

<h4 id="make-parameters-required-or-set-default">Make parameters required or set default</h4>

<pre class="highlight shell"><code>my_func<span class="o">()</span> <span class="o">{</span>&#x000A;    <span class="c"># required</span>&#x000A;    <span class="nb">local </span><span class="nv">my_param1</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span>:?<span class="k">}</span><span class="s2">"</span>&#x000A;    <span class="c"># default</span>&#x000A;    <span class="nb">local </span><span class="nv">my_param2</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">default</span><span class="p"> value</span><span class="k">}</span><span class="s2">"</span>&#x000A;    ...&#x000A;<span class="o">}</span>&#x000A;</code></pre>

<h4 id="if-able-pass-all-the-information-as-parameters">If able, pass all the information as parameters</h4>

<p>By maintaining the encapsulation, the reusability, maintainability and the debuggability (if any of those words exist) are greatly increased.</p>

<pre class="highlight shell"><code><span class="c"># No</span>&#x000A;my_func<span class="o">()</span> <span class="o">{</span>&#x000A;    ls <span class="s2">"</span><span class="nv">$DIR</span><span class="s2">"</span>&#x000A;    ...&#x000A;<span class="o">}</span>&#x000A;</code></pre>

<pre class="highlight shell"><code><span class="c"># Yes</span>&#x000A;my_func<span class="o">()</span> <span class="o">{</span>&#x000A;    <span class="nb">local </span><span class="nv">my_dir</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="p">?</span><span class="k">}</span><span class="s2">"</span>&#x000A;    ls <span class="s2">"</span><span class="nv">$my_dir</span><span class="s2">"</span>&#x000A;    ...&#x000A;<span class="o">}</span>&#x000A;</code></pre>

<h4 id="almost-no-functions-should-use-exit-use-return-instead">Almost no functions should use exit, use return instead</h4>

<p>Using exit will end any program that halls the function and will not allow no properly react on the event of a failure.</p>

<pre class="highlight shell"><code><span class="c"># No</span>&#x000A;my_func<span class="o">()</span> <span class="o">{</span>&#x000A;    <span class="o">[[</span> -e /dummy <span class="o">]]</span> <span class="se">\</span>&#x000A;    <span class="o">||</span> <span class="nb">exit </span>1&#x000A;<span class="o">}</span>&#x000A;</code></pre>

<pre class="highlight shell"><code><span class="c"># Yes</span>&#x000A;my_func<span class="o">()</span> <span class="o">{</span>&#x000A;    <span class="o">[[</span> -e /dummy <span class="o">]]</span> <span class="se">\</span>&#x000A;    <span class="o">||</span> <span class="k">return </span>1&#x000A;<span class="o">}</span>&#x000A;</code></pre>

<h4 id="prefer-return-statements-to-implicit-return">Prefer return statements to implicit return</h4>

<p>That helps the debuggability and avoids returning unexpected values.</p>

<pre class="highlight shell"><code><span class="c"># No</span>&#x000A;<span class="c"># the return code here is always 1</span>&#x000A;my_func<span class="o">()</span> <span class="o">{</span>&#x000A;    <span class="o">[[</span> -e /dummy <span class="o">]]</span> <span class="se">\</span>&#x000A;    <span class="o">&amp;&amp;</span> <span class="k">return </span>1&#x000A;<span class="o">}</span>&#x000A;</code></pre>

<pre class="highlight shell"><code><span class="c"># Yes</span>&#x000A;my_func<span class="o">()</span> <span class="o">{</span>&#x000A;    <span class="o">[[</span> -e /dummy <span class="o">]]</span> <span class="se">\</span>&#x000A;    <span class="o">&amp;&amp;</span> <span class="k">return </span>1&#x000A;    <span class="k">return </span>0&#x000A;<span class="o">}</span>&#x000A;</code></pre>

<h4 id="use-lowercase-and-underscores-for-vars-and-function-names">Use lowercase and underscores for vars and function names</h4>

<pre class="highlight shell"><code>my_func<span class="o">()</span> <span class="o">{</span>&#x000A;    ...&#x000A;<span class="o">}</span>&#x000A;&#x000A;<span class="nv">my_var</span><span class="o">=</span><span class="s2">"bla"</span>&#x000A;</code></pre>

<h1 id="note-on-portability">Note on portability</h1>

<p>If you can imagine a reason where you script is going to be executed on a machine where bash is not available (most common Linux distributions and GNU-based systems have bash as default shell, and can be easily installed on many others), you should use the POSIX standard.</p>

</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="/privacy/">Privacy policy</a></li>
<li><a target="_blank" href="/about/">About</a></li>
<li><a target="_blank" href="/disclaimers/">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2016 oVirt
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/develop/infra/infra-bash-style-guide.html.md"><i class="icon fa fa-pencil"></i>Edit this page on GitHub</a>
</div>
<div class='last-modified'>
Page last modified
Mon 30 Nov 2015 10:30 UTC
</div>
</footer>


<script src="/javascripts/application.js" type="text/javascript"></script>

<!-- eloqua -->
<script src='//www.redhat.com/j/elqNow/elqCfg.js' type='text/javascript'></script>
<script src='//www.redhat.com/j/elqNow/elqImg.js' type='text/javascript'></script>

</body>
</html>
